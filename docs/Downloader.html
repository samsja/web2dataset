---

title: Downloader


keywords: fastai
sidebar: home_sidebar

summary: "`Downloaders` are a one of the main block of web2dataset. They define the code to scrap the web for multi-model data"
description: "`Downloaders` are a one of the main block of web2dataset. They define the code to scrap the web for multi-model data"
nb_path: "nbs/Downloader.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/Downloader.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>here is the abstract class for the Downloader</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Downloader" class="doc_header"><code>class</code> <code>Downloader</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/downloader.py#L15" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Downloader</code>(<strong><code>path</code></strong>:<code>str</code>) :: <code>ABC</code></p>
</blockquote>
<p>Base class abstract for any downloader</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">web2dataset</span> <span class="kn">import</span> <span class="n">BasicDownloader</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">downloader</span> <span class="o">=</span> <span class="n">BasicDownloader</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;dataset.bin&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;wallpaper&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example: simple Downloader:
this class will be used of testing</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_folder</span> <span class="o">=</span> <span class="s2">&quot;/tmp/test&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">BasicDownloader</span><span class="p">(</span><span class="n">Downloader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_get_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Document</span><span class="p">(</span>
            <span class="n">tag</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.google.fr&quot;</span><span class="p">,</span>
                <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://raw.githubusercontent.com/fastai/fastai/master/nbs/images/puppy.jpg&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_item</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_doc</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_item</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>let's define a downloader that will search random wallpaper on the web</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">downloader</span> <span class="o">=</span> <span class="n">BasicDownloader</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_folder</span><span class="si">}</span><span class="s2">/my_search&quot;</span><span class="p">)</span>
<span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;wallpaper&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Under the hood the <a href="/web2dataset/Downloader.html#Downloader"><code>Downloader</code></a> save everything in memory in a <code>DocumentArray</code> from the <a href="https://docarray.jina.ai/">docarray</a> package</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">downloader</span><span class="o">.</span><span class="n">docs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-style: italic">            Documents Summary            </span>
                                         
  Length                 2               
  Homogenous Documents   True            
  Common Attributes      ('id', 'tags')  
                                         
<span style="font-style: italic">                     Attributes Summary                     </span>
                                                            
 <span style="font-weight: bold"> Attribute </span> <span style="font-weight: bold"> Data type </span> <span style="font-weight: bold"> #Unique values </span> <span style="font-weight: bold"> Has empty value </span> 
 ────────────────────────────────────────────────────────── 
  id          ('str',)    2                False            
  tags        ('dict',)   2                False            
                                                            
</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>we can now load the dataset in a <code>DocumentArray</code> to use it afterwards</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_folder</span><span class="si">}</span><span class="s2">/my_search/dataset.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">DocumentArray</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-style: italic">            Documents Summary            </span>
                                         
  Length                 2               
  Homogenous Documents   True            
  Common Attributes      ('id', 'tags')  
                                         
<span style="font-style: italic">                     Attributes Summary                     </span>
                                                            
 <span style="font-weight: bold"> Attribute </span> <span style="font-weight: bold"> Data type </span> <span style="font-weight: bold"> #Unique values </span> <span style="font-weight: bold"> Has empty value </span> 
 ────────────────────────────────────────────────────────── 
  id          ('str',)    2                False            
  tags        ('dict',)   2                False            
                                                            
</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before jumping into creating actual <a href="/web2dataset/Downloader.html#Downloader"><code>Downloader</code></a> let's define the core error</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DownloaderError" class="doc_header"><code>class</code> <code>DownloaderError</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/downloader.py#L57" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DownloaderError</code>() :: <code>ValueError</code></p>
</blockquote>
<p>Inappropriate argument value (of correct type).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ImageDownloader">ImageDownloader<a class="anchor-link" href="#ImageDownloader"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ImageDownloader" class="doc_header"><code>class</code> <code>ImageDownloader</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/downloader.py#L61" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ImageDownloader</code>(<strong><code>path</code></strong>:<code>str</code>) :: <a href="/web2dataset/Downloader.html#Downloader"><code>Downloader</code></a></p>
</blockquote>
<p>Specialize abstract downloader for image</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Google-Image-Downloader">Google Image Downloader<a class="anchor-link" href="#Google-Image-Downloader"> </a></h3><blockquote><p>The Google Image Downloader is one of the main <a href="/web2dataset/Downloader.html#Downloader"><code>Downloader</code></a> of web2dataset</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>to use this tutorial you need to have installed the <a href="https://chromedriver.chromium.org/downloads">chrome webdriver</a> which will play the role of the browser during the downloading</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>first lets design a simple context manager to open and close the web driver automatically</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">_get_driver</span><span class="p">()</span> <span class="k">as</span> <span class="n">driver</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we can define the google image downloader</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GoogleImageDownloaderError" class="doc_header"><code>class</code> <code>GoogleImageDownloaderError</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/downloader.py#L109" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GoogleImageDownloaderError</code>() :: <a href="/web2dataset/Downloader.html#DownloaderError"><code>DownloaderError</code></a></p>
</blockquote>
<p>Inappropriate argument value (of correct type).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GoogleImageDownloader" class="doc_header"><code>class</code> <code>GoogleImageDownloader</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/downloader.py#L113" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GoogleImageDownloader</code>(<strong><code>path</code></strong>:<code>str</code>) :: <a href="/web2dataset/Downloader.html#ImageDownloader"><code>ImageDownloader</code></a></p>
</blockquote>
<p>GoogleImageDownloader: A downloader to download image from google images</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">web2dataset</span> <span class="kn">import</span> <span class="n">GoogleImageDownloader</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">downloader</span> <span class="o">=</span> <span class="n">GoogleImageDownloader</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;red bike&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">downloader</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;dataset.bin&quot;</span><span class="p">)</span>
</pre></div>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">downloader</span> <span class="o">=</span> <span class="n">GoogleImageDownloader</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_folder</span><span class="si">}</span><span class="s2">/bikedataset&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_item</span> <span class="o">=</span> <span class="mi">16</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;bike&quot;</span><span class="p">,</span> <span class="n">n_item</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 43.9 ms, sys: 972 µs, total: 44.8 ms
Wall time: 2.24 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_item</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we downloaded our images let's plot them !</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">downloader</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uri</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;images/00fd9e78-9cab-11ec-b2e3-645d865124e9.jpg&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_img</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">d</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_folder</span><span class="si">}</span><span class="s2">/bikedataset/</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">d</span><span class="o">.</span><span class="n">load_uri_to_image_tensor</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">downloader</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">load_img</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">downloader</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">plot_image_sprites</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

