---

title: utils/data


keywords: fastai
sidebar: home_sidebar

summary: "It contains all the code that load data from files into docs"
description: "It contains all the code that load data from files into docs"
nb_path: "nbs/utils_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/utils_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">web2dataset.searcher</span> <span class="kn">import</span> <span class="n">BasicSearcher</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First we need a function that will load a json file into a document</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="file_to_doc" class="doc_header"><code>file_to_doc</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/utils_data.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>file_to_doc</code>(<strong><code>path_to_file</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Function  to load a json file into a web2dataset.Document
args:
    path_to_file: str. A string containing the path to a json file</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>before trying it out we need the define a function to know where the metadata are stored inside the search folder</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_metadata_path" class="doc_header"><code>get_metadata_path</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/utils_data.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_metadata_path</code>(<strong><code>path</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Function to get the metadata path
args:
    path: str. A string containing the path to the folder (where we have save a search for example)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path_test</span> <span class="o">=</span> <span class="s2">&quot;/tmp/my_search&quot;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path_test</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">searcher</span> <span class="o">=</span> <span class="n">BasicSearcher</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">searcher</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
<span class="n">searcher</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metadata_path</span> <span class="o">=</span> <span class="n">get_metadata_path</span><span class="p">(</span><span class="n">path_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">file_to_doc</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metadata_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#34;date&#34;: &#34;2021-12-04T12:35:18.136763+01:00&#34;, &#34;image_url&#34;: &#34;https://raw.githubusercontent.com/fastai/fastai/master/nbs/images/puppy.jpg&#34;, &#34;origin&#34;: &#34;https://www.google.fr&#34;, &#34;uuid&#34;: &#34;41a07e3e-54f6-11ec-b278-645d865124e9&#34;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">==</span> <span class="n">Document</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we know how to load one file let's define a function to load all of the metada files at once</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_docs" class="doc_header"><code>load_docs</code><a href="https://github.com/samsja/web2dataset/tree/main/web2dataset/utils_data.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_docs</code>(<strong><code>path</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Function the metadata of a dataset, i.e it load the docs from the metadata folder of the dataset
args:
    path: str. A string containing the path to the folder (where we have save a search for example)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docs</span> <span class="o">=</span> <span class="n">load_docs</span><span class="p">(</span><span class="n">path_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#34;date&#34;: &#34;2021-12-04T12:35:18.136763+01:00&#34;, &#34;image_url&#34;: &#34;https://raw.githubusercontent.com/fastai/fastai/master/nbs/images/puppy.jpg&#34;, &#34;origin&#34;: &#34;https://www.google.fr&#34;, &#34;uuid&#34;: &#34;41a07e3e-54f6-11ec-b278-645d865124e9&#34;},
 {&#34;date&#34;: &#34;2021-12-04T12:35:18.136726+01:00&#34;, &#34;image_url&#34;: &#34;https://raw.githubusercontent.com/fastai/fastai/master/nbs/images/puppy.jpg&#34;, &#34;origin&#34;: &#34;https://www.google.fr&#34;, &#34;uuid&#34;: &#34;41a07cc2-54f6-11ec-b278-645d865124e9&#34;},
 {&#34;date&#34;: &#34;2021-12-04T12:35:18.136685+01:00&#34;, &#34;image_url&#34;: &#34;https://raw.githubusercontent.com/fastai/fastai/master/nbs/images/puppy.jpg&#34;, &#34;origin&#34;: &#34;https://www.google.fr&#34;, &#34;uuid&#34;: &#34;41a07b3c-54f6-11ec-b278-645d865124e9&#34;},
 {&#34;date&#34;: &#34;2021-12-04T12:35:18.136628+01:00&#34;, &#34;image_url&#34;: &#34;https://raw.githubusercontent.com/fastai/fastai/master/nbs/images/puppy.jpg&#34;, &#34;origin&#34;: &#34;https://www.google.fr&#34;, &#34;uuid&#34;: &#34;41a0795c-54f6-11ec-b278-645d865124e9&#34;},
 {&#34;date&#34;: &#34;2021-12-04T12:35:18.136499+01:00&#34;, &#34;image_url&#34;: &#34;https://raw.githubusercontent.com/fastai/fastai/master/nbs/images/puppy.jpg&#34;, &#34;origin&#34;: &#34;https://www.google.fr&#34;, &#34;uuid&#34;: &#34;41a07628-54f6-11ec-b278-645d865124e9&#34;}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

